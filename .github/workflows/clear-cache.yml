name: ğŸ§¹ æš´åŠ›æ¸…ç©ºæ‰€æœ‰ç¼“å­˜

on: workflow_dispatch

jobs:
  clear-cache:
    runs-on: ubuntu-latest
    permissions:
      actions: write  # å¿…é¡»å¼€å¯å†™å…¥æƒé™
    steps:
      - name: Use GitHub API to delete caches
        uses: actions/github-script@v6
        with:
          script: |
            console.log("ğŸ” å¼€å§‹æ‰«æå¹¶æ¸…é™¤æ‰€æœ‰ç¼“å­˜...");
            const owner = context.repo.owner;
            const repo = context.repo.repo;
            
            // åªè¦è¿˜æœ‰ç¼“å­˜ï¼Œå°±ä¸€ç›´å¾ªç¯åˆ 
            while(true) {
                const { data: { actions_caches } } = await github.rest.actions.getActionsCacheList({
                  owner,
                  repo,
                  per_page: 100
                });
                
                if (actions_caches.length === 0) {
                  console.log("ğŸ‰ æ­å–œï¼æ‰€æœ‰ç¼“å­˜å·²å½»åº•æ¸…ç©ºï¼");
                  break;
                }
                
                console.log(`âš ï¸ å‘ç° ${actions_caches.length} ä¸ªé¡½å›ºç¼“å­˜ï¼Œå‡†å¤‡æ‰§è¡Œåˆ é™¤...`);
                
                for (const cache of actions_caches) {
                  try {
                    await github.rest.actions.deleteActionsCacheById({
                      owner,
                      repo,
                      cache_id: cache.id
                    });
                    console.log(`ğŸ—‘ï¸ å·²ç²‰ç¢ç¼“å­˜: ${cache.key} (ID: ${cache.id})`);
                  } catch (error) {
                    console.log(`âŒ åˆ é™¤å¤±è´¥ (ID: ${cache.id}): ${error.message}`);
                  }
                }
            }